<div class="container-fluid white-bg py-1">
  <div class="row mb-5">
    <div class="col">
      <div class="card gradient-bg text-white border-0">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h2 class="mb-1"><i class="bi bi-box-seam me-2"></i>Package Management</h2>
              <p class="mb-0 opacity-75">Manage your subscription packages</p>
            </div>
            <button
              class="btn btn-light text-gradient fw-bold"
              (click)="showAddForm()"
              *ngIf="!isFormVisible"
            >
              <i class="bi bi-plus-circle me-2"></i>Add New Package
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-5" *ngIf="isFormVisible">
    <div class="col-lg-8 mx-auto">
      <div class="card border-0">
        <div class="card-header gradient-bg text-white border-0 p-4">
          <h5 class="mb-0">
            <i
              class="bi"
              [class.bi-plus-circle]="!isEditMode"
              [class.bi-pencil-square]="isEditMode"
            ></i>
            {{ isEditMode ? 'Edit Package' : 'Add New Package' }}
          </h5>
        </div>
        <div class="card-body p-4">
          <form (ngSubmit)="savePackage()">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">Package Name</label>
                <input
                  type="text"
                  class="form-control"
                  [(ngModel)]="currentPackage.packageName"
                  name="packageName"
                  required
                />
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">One Time Total Cost</label>
                <input
                  type="number"
                  class="form-control"
                  [(ngModel)]="currentPackage.oneTimeTotalCost"
                  name="oneTimeCost"
                  required
                />
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">EMI Total Cost</label>
                <input
                  type="text"
                  class="form-control"
                  [(ngModel)]="currentPackage.emiTotalCost"
                  name="emiCost"
                  placeholder="e.g., 1000/month"
                  required
                />
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">Max Branches</label>
                <input
                  type="number"
                  class="form-control"
                  [(ngModel)]="currentPackage.maxBranches"
                  name="maxBranches"
                  required
                />
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">Max Students</label>
                <input
                  type="number"
                  class="form-control"
                  [(ngModel)]="currentPackage.maxStudents"
                  name="maxStudents"
                  required
                />
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">SMS Alert</label>
                <div class="form-check form-switch mt-2">
                  <input
                    type="checkbox"
                    class="form-check-input"
                    [(ngModel)]="currentPackage.isSmsAlert"
                    name="smsAlert"
                    id="smsAlert"
                  />
                  <label class="form-check-label" for="smsAlert">
                    {{ currentPackage.isSmsAlert ? 'Enabled' : 'Disabled' }}
                  </label>
                </div>
              </div>
            </div>

            <div class="d-flex gap-2 pt-3">
              <button type="submit" class="btn btn-gradient px-4">
                <i class="bi bi-check-circle me-2"></i>
                {{ isEditMode ? 'Update' : 'Save' }}
              </button>
              <button type="button" class="btn btn-secondary px-4" (click)="cancelForm()">
                <i class="bi bi-x-circle me-2"></i>Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4" *ngIf="packages.length > 0">
    <div *ngFor="let pkg of packages" class="col-md-6 col-lg-4">
      <div class="card package-card h-100 border-0">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <span class="badge badge-gradient fs-6">{{ pkg.packageName }}</span>
            <div class="btn-group btn-group-sm">
              <button
                class="btn btn-outline-primary btn-sm"
                (click)="editPackage(pkg)"
                title="Edit"
              >
                <i class="bi bi-pencil"></i>
              </button>
              <button
                class="btn btn-outline-danger btn-sm"
                (click)="deletePackage(pkg.packageId)"
                title="Delete"
              >
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>

          <div class="package-details flex-grow-1">
            <div class="detail-item mb-3">
              <span class="detail-label">One Time Cost</span>
              <p class="detail-value">₹{{ pkg.oneTimeTotalCost }}</p>
            </div>

            <div class="detail-item mb-3">
              <span class="detail-label">EMI Cost</span>
              <p class="detail-value">₹{{ pkg.emiTotalCost }}</p>
            </div>

            <div class="row">
              <div class="col-6">
                <div class="detail-item mb-3">
                  <span class="detail-label">Max Branches</span>
                  <p class="detail-value">
                    <span class="badge bg-info">{{ pkg.maxBranches }}</span>
                  </p>
                </div>
              </div>
              <div class="col-6">
                <div class="detail-item mb-3">
                  <span class="detail-label">Max Students</span>
                  <p class="detail-value">
                    <span class="badge bg-success">{{ pkg.maxStudents }}</span>
                  </p>
                </div>
              </div>
            </div>

            <div class="detail-item">
              <span class="detail-label">SMS Alert</span>
              <p class="detail-value">
                <span
                  class="badge"
                  [class.bg-success]="pkg.isSmsAlert"
                  [class.bg-secondary]="!pkg.isSmsAlert"
                >
                  {{ pkg.isSmsAlert ? 'Enabled' : 'Disabled' }}
                </span>
              </p>
            </div>
          </div>

          <!-- <div class="package-id text-center pt-3 border-top">
            <small class="text-muted"
              >Package ID: <strong>#{{ pkg.packageId }}</strong></small
            >
          </div> -->
        </div>
      </div>
    </div>
  </div>

  <div class="row" *ngIf="packages.length === 0 && !isFormVisible">
    <div class="col">
      <div class="card border-0 text-center py-5">
        <div class="card-body">
          <i
            class="bi bi-inbox text-muted"
            style="font-size: 3rem; display: block; margin-bottom: 1rem"
          ></i>
          <h5 class="text-muted mb-2">No Packages Found</h5>
          <p class="text-muted mb-4">Add a new package to get started</p>
          <button class="btn btn-gradient" (click)="showAddForm()">
            <i class="bi bi-plus-circle me-2"></i>Add First Package
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
